Flow org.gluu.agama.totp.main
     Basepath ""
// user authn
Log "@info user authn"
// Username password login
user | E = Trigger org.gluu.agama.totp.pw 
Log "@info user details " user
userId = user.data.userId
Log "@info user id " userId
userTOTPSecretKey | E = Call org.gluu.agama.totp.IdentityProcessor#getUserTOTPSecretKey userId
Log "@info user TOTP secret key from flow " userTOTPSecretKey
enrollData = false
// if no enrollment exist
When userTOTPSecretKey is null
     enrollData | E = Trigger org.gluu.agama.totp.enroll userId
     Log "@info enroll " enrollData E
enrollData | E = Call org.gluu.agama.totp.TOTPUtil#validateTOTP otp userTOTPSecretKey